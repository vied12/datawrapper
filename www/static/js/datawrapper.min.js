//      Datawrapper
(function(){var a=this,b;typeof exports!="undefined"?b=exports:b=a.Datawrapper={Parsers:{}},b.VERSION="0.7.1";var c=b.Core=function(){};_.extend(c,{initialize:function(){this.initLanguageLinks()},initLanguageLinks:function(){$("a[href|=#lang]").click(function(a){a.preventDefault(),$.ajax({url:"/api/account/lang",type:"PUT",data:JSON.stringify({lang:$(a.target).attr("href").substr(6)}),processData:!1,success:function(a){location.reload()}})})}})}).call(this),function(){var a=Datawrapper.Dataset=function(a){_.extend(a,{type:"delimited"}),this.__options=a};_.extend(a.prototype,{_initialize:function(){var a=this,b=a.__options},_fetchDelimited:function(a){var b=this,c=b.__options;c.url!==undefined&&(b.__lastUrl==c.url?loaded(b.__rawData):$.ajax({url:c.url,method:"GET",dataType:"text",success:function(c){b._delimtedLoaded(c),_.isFunction(a.success)&&a.success()}}))},_delimtedLoaded:function(a,b){var c=this,d=c.__options;c.__rawData=a;var e=new Datawrapper.Parsers.Delimited(d),f=e.parse(a);c._processData(f),c.__data=f,c.__loaded=!0},_processData:function(a){var c=this,d=new b;c.__seriesByName={},_.each(a.series,function(a){c.__seriesByName[a.name]=a,a._min=function(){return a.min},a._max=function(){return a.max},_.each(a.data,function(a){d.learn(a)})}),_.each(a.series,function(a){a.min=Number.MAX_VALUE,a.max=-Number.MAX_VALUE,a.total=0,_.each(a.data,function(b,c){a.data[c]=d.parse(b),isNaN(a.data[c])||(a.min=Math.min(a.min,a.data[c]),a.max=Math.max(a.max,a.data[c]),a.total+=a.data[c])}),a.origdata=a.data.slice()})},fetch:function(a){var b=this,c=b.__options;c.type=="delimited"&&b._fetchDelimited(a)},fetchRaw:function(){var a=this,b=a.__options;b.type=="delimited"&&a._delimtedLoaded(b.rawData)},series:function(a){var b=this;if(_.isString(a)){if(b.__seriesByName[a]!==undefined)return b.__seriesByName[a];throw'No series found with that name: "'+a+'"'}if(a!==undefined){if(b.__data.series[a]!==undefined)return b.__data.series[a];throw"No series found with that index: "+a}return this.__data.series},hasRowNames:function(){return this.__data.rowNames!==undefined},numRows:function(){return this.__data.series[0].data.length},eachRow:function(a){var b;for(b=0;b<this.numRows();b++)a(b)},eachSeries:function(a){_.each(this.series(),a)},rowNames:function(){return this.__data.rowNames},rowName:function(a){return this.__data.rowNames[a]},rowNameLabel:function(){return this.__data.rowNameLabel!==undefined?this.__data.rowNameLabel:""},filterRows:function(a){this.eachSeries(function(b){var c=[];b.total=0,b.min=Number.MAX_VALUE,b.max=Number.MAX_VALUE*-1,_.each(a,function(a){c.push(b.origdata[a]),b.total+=b.origdata[a],b.min=Math.min(b.min,b.origdata[a]),b.max=Math.max(b.max,b.origdata[a])}),b.data=c})}});var b=function(){this.__numbers=[],this.__knownFormats={"-.":/^[\-\.]?[0-9]+(\.[0-9]+)?$/,"-,":/^[\-,]?[0-9]+(,[0-9]+)?$/,",.":/^[0-9]{1,3}(,[0-9]{3})(\.[0-9]+)?$/,".,":/^[0-9]{1,3}(\.[0-9]{3})(,[0-9]+)?$/," .":/^[0-9]{1,3}( [0-9]{3})(\.[0-9]+)?$/," ,":/^[0-9]{1,3}( [0-9]{3})(,[0-9]+)?$/}};_.extend(b.prototype,{learn:function(a){this.__numbers.push(a)},_getFormat:function(){var a=this,b={},c=["",0];_.each(a.__numbers,function(d){_.each(a.__knownFormats,function(a,e){b[e]===undefined&&(b[e]=0),a.test(d)&&(b[e]+=1,b[e]>c[1]&&(c[0]=e,c[1]=b[e]))})});return c[0]},parse:function(a){var b=this,c=a,d=this.__format;if(a===null||a===undefined||a==="")return"n/a";d===undefined&&(d=this.__format=this._getFormat());if(d[0]==","||d[0]=="."||d[0]==" ")c=c.replace(d[0],"");d[1]!="."&&(c=c.replace(d[1],".")),c=Number(c);return isNaN(c)?a:c}})}.call(this),function(){var a=this,b=a._,c=a.jQuery||a.Zepto||a.ender,d=Datawrapper.UI=function(){this.initialize()};b.extend(d.prototype,{initialize:function(){this.initializeSignUp(),this.initializeLogout(),c("a[data-toggle=modal]").click(function(a){var b=c(a.target),d=c(b.data("target"));d.modal()}),this.Errors={}},checkPasswordStrength:function(a){return!0},checkPassword:function(a,b,d){var e,f;a===""?(f="#cur-pwd",e=Datawrapper.Messages.provideCurPwd):b.length<4?(f="#pwd",e=Datawrapper.Messages.pwdTooShort):b!=d&&(f="#pwd,#pwd2",e=Datawrapper.Messages.pwdMismatch);if(e){DW.logError(e,c(f.split(",")[0]).parents(".control-group")),c(f).parents(".control-group").addClass("error");return!1}return!0},clearAlerts:function(){c(".alert").remove(),c(".error").removeClass("error")},refreshHeader:function(){location.reload();return},initializeSignUp:function(){function b(a){var b=c(a.target).parents(".login-form"),d=c(".btn-login",b),e=CryptoJS.HmacSHA256,f=c(".login-pwd",b).val(),g=e(e(f,d.data("salt")).toString(),String(d.data("time"))).toString(),h={email:c(".login-email",b).val(),pwhash:g,time:d.data("time"),keeplogin:c(".keep-login",b).attr("checked")=="checked"};if(f===""){c(".login-pwd",b).parent().addClass("error");return!1}c(".control-group",b).removeClass("error"),c.ajax({url:"/api/auth/login",type:"POST",dataType:"json",data:JSON.stringify(h),success:function(a){a.status=="ok"?(c("#dwLoginForm").modal("hide"),c("input",b).val(""),b.data("target")?location.href=b.data("target"):location.reload()):(a.code=="login-invalid"?c(".login-pwd",b).parent().addClass("error"):a.code=="login-email-unknown"&&c(".login-email",b).parent().addClass("error"),DW.logError(a.message,b))}})}function a(){c.getJSON("/api/auth/salt",function(a){a.status=="ok"&&(c("#btn-register").data("salt",a.data.salt),c(".btn-login").data("salt",a.data.salt),c(".btn-login").data("time",a.data.time))})}c("a[href=#login], a[href=#signup]").click(function(b){c("#dwLoginForm").modal(),c("#dwLoginForm .alert").remove();var d=c(b.target),e=d.attr("href")=="#login";e?c("#dwLoginForm .login-email").focus():(c("#register-email").focus(),c(".row-login").css("opacity",.5),c(".row-login *").click(function(){c(".row-login").css("opacity",1)})),d.data("target")&&c("#dwLoginForm .login-form").data("target",d.data("target"));var f=c("#home-login .login-form .login-email"),g=c("#home-login .login-form .login-pwd");f.val()!==""&&c("#register-email").val(f.val()),g.val()!==""&&c("#register-pwd").val(g.val()),a();return!1}),a(),c("#btn-register").click(function(){var a=c.trim(c("#register-pwd").val()),b=c.trim(c("#register-pwd-2").val());if(a==b){var d={email:c("#register-email").val(),pwd:CryptoJS.HmacSHA256(a,c("#btn-register").data("salt")).toString(),pwd2:CryptoJS.HmacSHA256(b,c("#btn-register").data("salt")).toString()};c.ajax({url:"/api/users",type:"POST",data:JSON.stringify(d),dataType:"json",context:this,success:function(a){if(a.status=="ok"){c(".signup-form input").val("");DW.logMessage("Yeah, sign up went well! You are logged in now...",".signup-form");setTimeout(function(){c("#dwLoginForm").modal("hide");DW.refreshHeader()},1e3)}else{DW.logError(a.code,".signup-form")}}})}else alert("Error: password mismatch")}),c(".btn-login").click(b),c(".login-form input").keyup(function(a){a.keyCode==13&&b(a)})},initializeLogout:function(){c("a[href=#logout]").click(function(){c.ajax({url:"/api/auth/logout",type:"POST",success:function(a){location.href="/"}});return!1})},logMessage:function(a,d,e){b.isFunction(d.prepend)||(d=c(d)),c(".alert",d).remove(),e===undefined&&(e="success");var f=c('<div class="alert alert-'+e+'" />');f.append('<a class="close" data-dismiss="alert" href="#">&times;</a>'),f.append("<div>"+a+"</div>"),d.prepend(f),c(".alert").alert()},logError:function(a,b){this.logMessage(a,b,"error")},resendActivationMail:function(a){var b=c.ajax({url:"/api/account/resend-activation",type:"POST",dataType:"json"});a&&b.done(function(b){b.status=="ok"?DW.logMessage(b.data,a):DW.logError(b.message,a)});return b},popupChart:function(a,b){c.getJSON("/api/charts/"+a,function(a){if(a.status=="ok"){var d=a.data,e=b?"http://"+DW.__domain+"/chart/"+d.id+"/preview":"http://"+DW.__chartCacheDomain+"/"+d.id;chartIframe=c('<iframe src="'+e+'" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>'),wrapper=c("<div></div>"),overlay=wrapper.overlay({onClose:function(){location.hash=""}}),wrapper.append('<a class="close close-button">&#9747;</a>'),wrapper.append(chartIframe),chartIframe.css({width:d.metadata.publish["embed-width"],height:d.metadata.publish["embed-height"],background:d.metadata.publish.background||"#fff",border:"10px solid "+(d.metadata.publish.background||"#fff"),"border-radius":10}),overlay.open(),location.hash!="#/"+d.id&&(location.hash="#/"+d.id)}})}}),c(function(){window.DW=new Datawrapper.UI})}.call(this),function(){var a=Datawrapper.Chart=function(a){this.__attributes=a};_.extend(a.prototype,{get:function(a,b){var c=a.split("."),d=this.__attributes;_.each(c,function(a){if(d===undefined)return b;d=d[a]});return _.isUndefined(d)||_.isNull(d)?b:d},dataset:function(a,b){var c=this,d,e={delimiter:"auto",url:"data",transpose:b?!1:this.get("metadata.data.transpose",!1),firstRowIsHeader:this.get("metadata.data.horizontal-header",!0),firstColumnIsHeader:this.get("metadata.data.vertical-header",!0)};c.__dataset=d=new Datawrapper.Dataset(e),d.fetch({success:function(){a(d);if(c.__datasetLoadedCallbacks)for(var b=0;b<c.__datasetLoadedCallbacks.length;b++)c.__datasetLoadedCallbacks[b](c)}});return d},rawData:function(a){var b=this,c={rawData:a,delimiter:"auto",transpose:this.get("metadata.data.transpose",!1),firstRowIsHeader:this.get("metadata.data.horizontal-header",!0),firstColumnIsHeader:this.get("metadata.data.vertical-header",!0)};b.__dataset=ds=new Datawrapper.Dataset(c),ds.fetchRaw()},datasetLoaded:function(a){var b=this;b.__dataset.__loaded?a(b):(b.__datasetLoadedCallbacks||(b.__datasetLoadedCallbacks=[]),b.__datasetLoadedCallbacks.push(a))},dataSeries:function(a,b){var c=this;ds=[],c.__dataset.eachSeries(function(a,b){ds.push(a)}),a===!0?ds=ds.sort(function(a,b){return b.data[0]>a.data[0]?1:-1}):$.type(a)=="number"&&(ds=ds.sort(function(b,c){return c.origdata[a]>b.origdata[a]?1:-1})),b&&ds.reverse();return ds},seriesByName:function(a){return this.__dataset.series(a)},numRows:function(){return this.__dataset.numRows()},hasColHeader:function(a){var b=this.get("metadata.data.transpose");return(a?!b:b)?this.get("metadata.data.vertical-header"):this.get("metadata.data.horizontal-header")},hasRowHeader:function(){return this.hasColHeader(!0)},rowHeader:function(){var a=this.__dataset;return this.hasRowHeader()?{data:a.rowNames()}:!1},rowLabels:function(){if(this.hasRowHeader())return this.rowHeader().data;var a=[];for(var b=0;b<this.numRows();b++)a.push("Row "+(b+1));return a},rowLabel:function(a){return this.hasRowHeader()?this.rowHeader().data[a]:a},hasHighlight:function(){var a=this.get("metadata.visualize.highlighted-series");return _.isArray(a)&&a.length>0},isHighlighted:function(a){if(a===undefined)return!1;var b=this.get("metadata.visualize.highlighted-series");return!_.isArray(b)||b.length===0||_.indexOf(b,a.name)>=0},setLocale:function(a,b){this.locale=a,this.metric_prefix=b},formatValue:function(a,b,c){var d=this,e=d.get("metadata.describe.number-format"),f=Number(d.get("metadata.describe.number-divisor")),g=d.get("metadata.describe.number-append","").replace(" ","&nbsp;"),h=d.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");f!==0&&(a=Number(a)/Math.pow(10,f));if(e!="-"){if(c||a==Math.round(a))e=e.substr(0,1)+"0";a=Globalize.format(a,e)}else f!==0&&(a=a.toFixed(1));return b?h+a+g:a},filterRow:function(a){this.__dataset.filterRows([a])},filterRows:function(a){this.__dataset.filterRows(a)},hasMissingValues:function(){var a=!1;_.each(this.dataSeries(),function(b){_.each(b.data,function(b){if(b!=Number(b)){a=!0;return!1}});if(a)return!1});return a}})}.call(this),function(){var a=Datawrapper.EditableChart=function(a){var b=this;b.__attributes=a,b.__changed=!1,b.__changeCallbacks=[],b.__saveCallbacks=[],b.__syncedElements=[]};_.extend(a.prototype,Datawrapper.Chart.prototype,{set:function(a,b){var c=a.split("."),d=this,e=c.pop(),f=d.__attributes;_.each(c,function(a){_.isArray(f[a])&&f[a].length===0&&(f[a]={}),f=f[a]}),f[e]!=b&&(f[e]=b,d.__changed=!0,clearTimeout(d.__saveTimeout),d.__saveTimeout=setTimeout(function(){d.save()},300),_.each(d.__changeCallbacks,function(c){c.call(this,d,a,b)}));return this},onChange:function(a){this.__changeCallbacks.push(a)},sync:function(a,b,c){function f(a){var b,c;b=a.data("sync-attribute"),a.is("input[type=checkbox]")?c=a.attr("checked")=="checked":a.is("input[type=text]")||a.is("textarea")||a.is("select")?c=a.val():a.is("input[type=radio]")&&(c=$("input:radio[name="+a.attr("name")+"]:checked").val(),c==="yes"?c=!0:c==="no"&&(c=!1)),c!==undefined&&e.set(b,c)}_.isString(a)&&(a=$(a)),a.data("sync-attribute",b);var d=this.get(b,c);a.is("input[type=checkbox]")?d?a.attr("checked","checked"):a.removeAttr("checked"):a.is("input[type=text]")||a.is("textarea")||a.is("select")?a.val(d):a.is("input[type=radio]")&&(_.isBoolean(d)&&(d=d?"yes":"no"),$("input:radio[name="+a.attr("name")+"][value="+d+"]").attr("checked","checked"));var e=this;e.__syncedElements.push(a),a.change(function(a){f($(a.target))}),window.onbeforeunload=function(a){if(e.__changed)return"Caution: unsaved changes"}},onSave:function(a){this.__saveCallbacks.push(a)},save:function(a){if(!this.__changed)return!1;clearTimeout(this.__saveTimeout);var b=this;$.ajax({url:"/api/charts/"+this.get("id"),type:"PUT",dataType:"json",data:JSON.stringify(this.__attributes),processData:!1,context:this,success:function(a){a.status=="ok"?(this.__changed=!1,_.each(this.__saveCallbacks,function(a){a.call(this,b)})):console.warn("could not save the chart",a)}});return!0}})}.call(this),function(){Datawrapper.Themes={},Datawrapper.Themes.Base=_.extend({},{colors:{palette:["#6E7DA1","#64A4C4","#53CCDD","#4EF4E8"],secondary:["#000000","#777777","#cccccc","#ffd500","#6FAA12"],positive:"#85B4D4",negative:"#E31A1C",background:"#ffffff",text:"#000000"},padding:{left:0,right:20,bottom:30,top:10},lineChart:{strokeWidth:3,maxLabelWidth:80,fillOpacity:.2,xLabelOffset:20},columnChart:{cutGridLines:!1},barChart:{},xAxis:{stroke:"#333"},yAxis:{strokeWidth:1},horizontalGrid:{stroke:"#d9d9d9"},verticalGrid:!1,frame:!1,frameStrokeOnTop:!1,yTicks:!1,hover:!0,tooltip:!0,hpadding:0,vpadding:10,minWidth:400,locale:"de_DE"})}.call(this),function(){Datawrapper.Parsers.Delimited=function(a){a=a||{},this.delimiter=a.delimiter||",",this.quoteChar=a.quoteChar||'"',this.skipRows=a.skipRows||0,this.emptyValue=a.emptyValue||null,this.transpose=a.transpose||!1,this.firstRowIsHeader=a.firstRowIsHeader!==undefined?a.firstRowIsHeader:!0,this.firstColumnIsHeader=a.firstRowIsHeader!==undefined?a.firstColumnIsHeader:!0,this.getDelimiterPatterns=function(a,b){return new RegExp("(\\"+a+"|\\r?\\n|\\r|^)"+"(?:"+b+"([^"+b+"]*(?:"+b+'"[^'+b+"]*)*)"+b+"|"+"([^"+b+"\\"+a+"\\r\\n]*))","gi")},this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar)},_.extend(Datawrapper.Parsers.Delimited.prototype,Datawrapper.Parsers.prototype,{parse:function(a){this.__rawData=a,this.delimiter=="auto"&&(this.delimiter=this.guessDelimiter(a,this.skipRows),this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar));var b=[],c=this.delimiter!="|"?"|":"#",d;a=c+a.replace(/\s+$/g,"")+c;var e=function(a,b,d){d=d||",";var e=[[]],f=null,g;while(f=a.exec(b)){var h=f[1];h.length&&h!=d&&e.push([]),f[2]?g=f[2].replace(new RegExp('""',"g"),'"'):g=f[3],e[e.length-1].push(g)}e[0][0].substr(0,1)==c&&(e[0][0]=e[0][0].substr(1));var i=e.length-1,j=e[i].length-1,k=e[i][j].length-1;e[i][j].substr(k)==c&&(e[i][j]=e[i][j].substr(0,k));return e},f=function(a){var b=a,c=b.length?b.length:0,d=b[0]instanceof Array?b[0].length:0;if(d===0||c===0)return[];var e,f,g=[];for(e=0;e<d;e++){g[e]=[];for(f=0;f<c;f++)g[e][f]=b[f][e]}return g};parseDataArray=function(a,b,c,d,e){var f=[],g={},h=a.length,i=a[0].length,j=b,k=[];d&&(k=a[j],j++);for(var l=0;l<i;l++){var m=_.isString(k[l])?k[l].replace(/^\s+|\s+$/g,""):"",n=m!==""?"":1;m=m!==""?m:"X.";while(g[m+n]!==undefined)n=n===""?1:n+1;f.push({name:m+n,data:[]}),g[m+n]=!0}for(;j<h;j++)_.each(f,function(b,d){b.data.push(a[j][d]!==""?a[j][d]:c)});var o;e&&(o=f[0],f=f.slice(1));return{series:f,rowNames:o?o.data:undefined,rowNameLabels:o?o.name:undefined}},d=e(this.__delimiterPatterns,a,this.delimiter);if(this.transpose){d=f(d);var g=this.firstRowIsHeader;this.firstRowIsHeader=this.firstColumnIsHeader,this.firstColumnIsHeader=g}return parseDataArray(d,this.skipRows,this.emptyValue,this.firstRowIsHeader,this.firstColumnIsHeader)},guessDelimiter:function(a){var b=0,c=-1,d=this,e=["\t",";","|",","];_.each(e,function(e,f){var g=d.getDelimiterPatterns(e,d.quoteChar),h=a.match(g).length;h>b&&(b=h,c=f)});return e[c]}})}(this,_),function(){Datawrapper.Visualizations={};var a=function(){};_.extend(a.prototype,{render:function(a){$(a).html("implement me!")},setTheme:function(a){this.theme=a;var b=["horizontalGrid","verticalGrid","yAxis","xAxis"];_.each(b,function(b){if(a.hasOwnProperty(b))for(var c in a[b]){var d=c.replace(/([A-Z])/g,"-$1").toLowerCase();a[b].hasOwnProperty(d)||(a[b][d]=a[b][c])}});return this},setSize:function(a,b){var c=this;c.__w=a,c.__h=b;return c},load:function(a,b){var c=this;this.chart=a,a.dataset(function(a){c.dataset=a,b.call(c,c)})},get:function(a,b){return this.chart.get("metadata.visualize."+a,b)},warn:function(a){var b=$("<div>"+a+"</div>");b.css({"background-color":"#FCF8E3",border:"1px solid #FBEED5","border-radius":"4px 4px 4px 4px",color:"#a07833","margin-bottom":"18px",padding:"8px 35px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)",left:"10%",right:"10%","text-align":"center",position:"absolute"}),$("body").prepend(b),b.hide(),b.fadeIn()},signature:function(){}}),Datawrapper.Visualizations.Base=a.prototype}.call(this)